add_random_leader_floret_trait = {
	log_error = "started scripted effect"
	save_event_target_as = new_owner
	reroll_random = yes
	if = { #Is a science ship commander
		limit = {
			leader_class = scientist
		}
		while = {
			limit = {
				NOT = { # Don't have leader gain normal trait and floret trait at same level
					#has_leader_flag = has_gained_trait # timed flag added with random trait gain
					has_leader_flag = has_gained_floret
				}
			}
			random_list = {
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_cutie_sci }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_cutie_sci
						add_ruler_trait = leader_trait_cutie_rul
						set_timed_leader_flag = { flag = gained_leader_trait_cutie_sci days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_distracted_sci }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_distracted_sci
						add_ruler_trait = leader_trait_distracted_rul
						set_timed_leader_flag = { flag = gained_leader_trait_distracted_sci days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_brainslug_sci }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
										has_trait = trait_brainslug
									}
								}
							}
						}
						add_trait = leader_trait_brainslug_sci
						add_ruler_trait = leader_trait_brainslug_rul
						set_timed_leader_flag = { flag = gained_leader_trait_brainslug_sci days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
			}
		}
		owner = { country_event = { id = domestication_leader.3 } }
	}
	if = {
		limit = {
			leader_class = admiral
		}
		while = {
			limit = {
				NOT = { # Don't have leader gain normal trait and floret trait at same level
					#has_leader_flag = has_gained_trait # timed flag added with random trait gain
					has_leader_flag = has_gained_floret
				}
			}
			random_list = {
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_cutie_adm }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_cutie_adm
						add_ruler_trait = leader_trait_cutie_rul
						set_timed_leader_flag = { flag = gained_leader_trait_cutie_adm days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_brainslug_adm }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
										has_trait = trait_brainslug
									}
								}
							}
						}
						add_trait = leader_trait_brainslug_adm
						add_ruler_trait = leader_trait_brainslug_rul
						set_timed_leader_flag = { flag = gained_leader_trait_brainslug_adm days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
			}
		}
		owner = { country_event = { id = domestication_leader.3 } }
	}
	if = {
		limit = {
			leader_class = governor
		}
		while = {
			limit = {
				NOT = { # Don't have leader gain normal trait and floret trait at same level
					#has_leader_flag = has_gained_trait # timed flag added with random trait gain
					has_leader_flag = has_gained_floret
				}
			}
			random_list = {
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_cutie_gov }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_cutie_gov
						add_ruler_trait = leader_trait_cutie_rul
						set_timed_leader_flag = { flag = gained_leader_trait_cutie_gov days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_beeple_gov }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									OR = {
										has_origin = origin_syncretic_evolution
										has_origin = origin_domesticators
									}
									any_owned_pop = {
										has_job = floret
										has_trait = trait_syncretic_proles
									}
								}
							}
						}
						add_trait = leader_trait_beeple_gov
						add_ruler_trait = leader_trait_beeple_rul
						set_timed_leader_flag = { flag = gained_leader_trait_beeple_gov days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_liason_gov }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									has_origin = origin_syncretic_evolution
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_liason_gov
						add_ruler_trait = leader_trait_liason_rul
						set_timed_leader_flag = { flag = gained_leader_trait_liason_gov days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_brainslug_gov }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
										has_trait = trait_brainslug
									}
								}
							}
						}
						add_trait = leader_trait_brainslug_gov
						add_ruler_trait = leader_trait_brainslug_rul
						set_timed_leader_flag = { flag = gained_leader_trait_brainslug_gov days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
			}
		}
		owner = { country_event = { id = domestication_leader.3 } }
	}
	if = {
		limit = {
			leader_class = general
		}
		while = {
			limit = {
				NOT = { # Don't have leader gain normal trait and floret trait at same level
					#has_leader_flag = has_gained_trait # timed flag added with random trait gain
					has_leader_flag = has_gained_floret
				}
			}
			random_list = {
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_cutie_gen }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
									}
								}
							}
						}
						add_trait = leader_trait_cutie_gen
						add_ruler_trait = leader_trait_cutie_rul
						set_timed_leader_flag = { flag = gained_leader_trait_cutie_gen days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
				5 = {
					if = {
						limit = {
							NOT = { has_trait = leader_trait_brainslug_gen }
							owner = {
								AND = {
									is_domesticator_or_protectorate = yes
									any_owned_pop = {
										has_job = floret
										has_trait = trait_brainslug
									}
								}
							}
						}
						add_trait = leader_trait_brainslug_gen
						add_ruler_trait = leader_trait_brainslug_rul
						set_timed_leader_flag = { flag = gained_leader_trait_brainslug_gen days = 7 }
						set_timed_leader_flag = { flag = has_gained_floret days = 7 }
					}
				}
			}
		}
		owner = { country_event = { id = domestication_leader.3 } }
	}
	if = {
		limit = {
			leader_class = ruler
		}
		while = {
			limit = {
				NOT = { # Don't have leader gain normal trait and floret trait at same level
					#has_leader_flag = has_gained_trait # timed flag added with random trait gain
					has_leader_flag = has_gained_floret
				}
			}
			random_list = {
				5 = {}
			}
		}
		#owner = { country_event = { id = leader.25} }
	}
}

# this = country
get_pirate_species = {
	owner_species = { save_event_target_as = country_species }
	if = {
		limit = {
			is_domesticator_or_protectorate = yes
			any_owned_species = {
				NOR = {
					is_same_species = event_target:country_species
					is_subspecies = event_target:country_species
					is_robotic = yes
					is_sapient = no
				}
			}
		}
		random_owned_pop = {
			limit = {
				species = {
					NOR = {
						is_same_species = event_target:country_species
						is_subspecies = event_target:country_species
						is_robotic = yes
						is_sapient = no
					}
				}
			}
			weights = {
				base = 1
				modifier = {
					factor = 5
					OR = {
						pop_has_ethic = ethic_fanatic_xenophobe
						pop_has_ethic = ethic_xenophobe
					}
				}
				modifier = {
					factor = 0.1
					has_job = floret
				}
			}
			species = { save_event_target_as = owner_species }
		}
	}
	else = {
		event_target:country_species = { save_event_target_as = owner_species }
	}
}

# from old_bloom to new_bloom
copy_leader_traits = {

	# holy hell, we need to copy over every leader trait individually
	# maybe let's only copy over floret traits
	event_target:old_bloom = {
		if = {
			limit = {
				is_variable_set = affini_id_1
			}
			event_target:new_bloom = {
				set_variable = {
					which = affini_id_1
					value = prev.affini_id_1
				}
			}
		}
		if = {
			limit = {
				is_variable_set = affini_id_2
			}
			event_target:new_bloom = {
				set_variable = {
					which = affini_id_2
					value = prev.affini_id_2
				}
			}
		}


		#if = { limit = { has_trait = leader_trait_cutie_adm }	event_target:new_bloom = { add_trait = leader_trait_cutie_adm }	}
		#if = { limit = { has_trait = leader_trait_warp_eng_adm } event_target:new_bloom = { add_trait = leader_trait_warp_eng_adm }	}
		#if = { limit = { has_trait = leader_trait_pirate_adm } event_target:new_bloom = { add_trait = leader_trait_pirate_adm }	}
		#if = { limit = { has_trait = leader_trait_admiral_adm }	event_target:new_bloom = { add_trait = leader_trait_admiral_adm }	}
		#if = { limit = { has_trait = leader_trait_officer_adm }	event_target:new_bloom = { add_trait = leader_trait_officer_adm }	}
		#if = { limit = { has_trait = leader_trait_marauder_adm }event_target:new_bloom = { add_trait = leader_trait_marauder_adm }	}
		#if = { limit = { has_trait = leader_trait_warform_adm } event_target:new_bloom = { add_trait = leader_trait_warform_adm }	}

		#if = { limit = { has_trait = leader_trait_cutie_gen }	event_target:new_bloom = { add_trait = leader_trait_cutie_gen }	}
		#if = { limit = { has_trait = leader_trait_attache_gen }	event_target:new_bloom = { add_trait = leader_trait_attache_gen }	}

		#if = { limit = { has_trait = leader_trait_beeple_gov } event_target:new_bloom = { add_trait = leader_trait_beeple_gov }	}
		#if = { limit = { has_trait = leader_trait_cutie_gov }	event_target:new_bloom = { add_trait = leader_trait_cutie_gov }	}
		#if = { limit = { has_trait = leader_trait_liason_gov }	event_target:new_bloom = { add_trait = leader_trait_liason_gov }	}
		#if = { limit = { has_trait = leader_trait_economist_gov }	event_target:new_bloom = { add_trait = leader_trait_economist_gov }	}
		#if = { limit = { has_trait = leader_trait_dathnak_gov }	event_target:new_bloom = { add_trait = leader_trait_dathnak_gov }	}
		#if = { limit = { has_trait = leader_trait_racket_gov }	event_target:new_bloom = { add_trait = leader_trait_racket_gov }	}
		#if = { limit = { has_trait = leader_trait_cryopod_gov }	event_target:new_bloom = { add_trait = leader_trait_cryopod_gov }	}

		#if = { limit = { has_trait = leader_trait_cutie_sci }	event_target:new_bloom = { add_trait = leader_trait_cutie_sci }	}
		#if = { limit = { has_trait = leader_trait_distracted_sci }	event_target:new_bloom = { add_trait = leader_trait_distracted_sci }	}
		#if = { limit = { has_trait = leader_trait_academic_sci }	event_target:new_bloom = { add_trait = leader_trait_academic_sci }	}
		#if = { limit = { has_trait = leader_trait_dathnak_sci }	event_target:new_bloom = { add_trait = leader_trait_dathnak_sci }	}
		#if = { limit = { has_trait = leader_trait_stranded_sci }	event_target:new_bloom = { add_trait = leader_trait_stranded_sci }	}

		if = { limit = { has_ruler_trait = leader_trait_cutie_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_cutie_rul }
			event_target:new_bloom = { add_trait = leader_trait_cutie_gov }
			event_target:new_bloom = { add_trait = leader_trait_cutie_sci }
			event_target:new_bloom = { add_trait = leader_trait_cutie_adm }
			event_target:new_bloom = { add_trait = leader_trait_cutie_gen }
		}
		if = { limit = { has_ruler_trait = leader_trait_beeple_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_beeple_rul }
			event_target:new_bloom = { add_trait = leader_trait_beeple_gov }
		}
		if = { limit = { has_ruler_trait = leader_trait_warp_eng_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_warp_eng_rul }
			event_target:new_bloom = { add_trait = leader_trait_warp_eng_adm }
		}
		if = { limit = { has_ruler_trait = leader_trait_pirate_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_pirate_rul }
			event_target:new_bloom = { add_trait = leader_trait_pirate_adm }
		}
		if = { limit = { has_ruler_trait = leader_trait_admiral_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_admiral_rul }
			event_target:new_bloom = { add_trait = leader_trait_admiral_adm }
		}
		if = { limit = { has_ruler_trait = leader_trait_distracted_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_distracted_rul }
			event_target:new_bloom = { add_trait = leader_trait_distracted_sci }
		}
		if = { limit = { has_ruler_trait = leader_trait_liason_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_liason_rul }
			event_target:new_bloom = { add_trait = leader_trait_liason_gov }
		}
		if = { limit = { has_ruler_trait = leader_trait_attache_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_attache_rul }
			event_target:new_bloom = { add_trait = leader_trait_attache_gen }
		}
		if = { limit = { has_ruler_trait = leader_trait_officer_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_officer_rul }
			event_target:new_bloom = { add_trait = leader_trait_officer_adm }
			}
		if = { limit = { has_ruler_trait = leader_trait_economist_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_economist_rul }
			event_target:new_bloom = { add_trait = leader_trait_economist_gov }
		}
		if = { limit = { has_ruler_trait = leader_trait_academic_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_academic_rul }
			event_target:new_bloom = { add_trait = leader_trait_academic_sci }
		}
		if = { limit = { has_ruler_trait = leader_trait_marauder_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_marauder_rul }
			event_target:new_bloom = { add_trait = leader_trait_marauder_adm }
		}
		if = { limit = { has_ruler_trait = leader_trait_dathnak_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_dathnak_rul }
			event_target:new_bloom = { add_trait = leader_trait_dathnak_sci }
		}
		if = { limit = { has_ruler_trait = leader_trait_warform_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_warform_rul }
			event_target:new_bloom = { add_trait = leader_trait_warform_adm }
		}
		if = { limit = { has_ruler_trait = leader_trait_stranded_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_stranded_rul }
			event_target:new_bloom = { add_trait = leader_trait_stranded_sci }
		}
		if = { limit = { has_ruler_trait = leader_trait_racket_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_racket_rul }
			event_target:new_bloom = { add_trait = leader_trait_racket_gov }
		}
		if = { limit = { has_ruler_trait = leader_trait_cryopod_rul }
			event_target:new_bloom = { add_ruler_trait = leader_trait_cryopod_rul }
			event_target:new_bloom = { add_trait = leader_trait_cryopod_gov }
		}

	}
}

add_domprot_leader_trait = {

}

remove_domprot_leader_trait = {

}

refresh_subject_count_loyalty_penalty = {
	every_subject = {
		erase_modifier = { MOD = divided_patronage }
	}
	if = {
		limit = {
			NOR = {
				has_civic = civic_feudal_realm
				has_civic = civic_franchising
				has_ascension_perk = ap_shared_destiny
			}
			subjects > 1
		}
		set_variable = { which = subjects_minus_one value = trigger:subjects }
		subtract_variable = { which = subjects_minus_one value = 1 }
		set_variable = { which = domprot_subject_modifier value = this.subjects_minus_one }
		divide_variable = { which = domprot_subject_modifier value = 2 }
		every_subject = {
			if = {
				limit = {
					PREV = {
						is_domesticator = yes
					}
					OR = {
						any_agreement = { agreement_preset = preset_protectorate }
						is_specialist_subject_type = { TYPE = domprot }
					}
				}
				if = {
					# Rank 3 DomProt has no loyalty penalty
					limit = {
						NOT = { any_agreement = { specialist_tier = 3} }
					}
					add_modifier = {
						modifier = divided_patronage
						multiplier = PREV.domprot_subject_modifier
					}
				}
			}
			else = {
				add_modifier = {
					modifier = divided_patronage
					multiplier = PREV.subjects_minus_one
				}
			}
		}
		clear_variable = subjects_minus_one
		clear_variable = domprot_subject_modifier
	}
}
